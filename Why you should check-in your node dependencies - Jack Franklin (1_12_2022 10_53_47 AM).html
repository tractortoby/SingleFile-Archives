<!DOCTYPE html> <html class="ahysmjgfx idc0_335" lang=en><!--
 Page saved with SingleFile 
 url: https://www.jackfranklin.co.uk/blog/check-in-your-node-dependencies/ 
 saved date: Wed Jan 12 2022 10:53:47 GMT+0800 (China Standard Time)
--><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--dark:#353535ff;--green:#3c6e71ff;--white:#ffffffff;--grey:#d9d9d9;--blue:#284b63ff;--spacing-unit:4px;--space-s:var(--spacing-unit);--space-m:calc(2 * var(--spacing-unit));--space-l:calc(4 * var(--spacing-unit));--space-xl:calc(8 * var(--spacing-unit));--size-300:0.75rem;--size-400:1rem;--size-500:1.33rem;--size-600:1.77rem;--size-700:2.36rem;--size-800:3.15rem;--size-900:4.2rem}body,html{font-family:'Noto Sans',sans-serif}body{padding:0;margin:0;line-height:1.5}.flow>*+*,.post ol>li+li,.post ul>li+li{margin-top:var(--flow-space,1em)}*{box-sizing:border-box}a:link,a:visited{color:var(--blue);text-decoration:none;border-bottom:2px solid var(--blue);transition:all .1s ease-in}a:hover{color:var(--dark);border-bottom:2px solid var(--dark)}h1 a:link,h1 a:visited,h2 a:link,h2 a:visited,h3 a:link,h3 a:visited,h4 a:link,h4 a:visited,h5 a:link,h5 a:visited{color:var(--dark);text-decoration:none;border-bottom:none}h1,h2{margin:0;line-height:1.3}h1{font-size:var(--size-800);font-weight:900;color:var(--dark)}h2{font-size:var(--size-700);font-weight:600;color:var(--dark)}@media (min-width:45em){h1{font-size:var(--size-900)}h2{font-size:var(--size-700)}li,p{font-size:var(--size-500)!important}blockquote p{font-size:var(--size-600);max-width:40ch}.post time{font-size:var(--size-600)}}li,p:not(.formkit-teaser){max-width:60ch}blockquote p{max-width:80ch}.post h1{max-width:20ch}.post h2{max-width:25ch}header{margin-bottom:var(--space-l);background:var(--green);padding:var(--space-l)}header a:link,header a:visited{color:var(--white)}header nav a:link,header nav a:visited{border-bottom:2px solid var(--white)}header h1 a:hover,header nav a:hover{border-bottom:none}header nav ul{margin:var(--space-m) 0;padding:0;display:flex;list-style:none}header nav li{padding:0 var(--space-l)}header nav li:first-child{padding-left:0}.content{width:95%;max-width:800px;padding:var(--space-s) var(--space-l)}.content li,.content p{color:var(--dark)}.post time{color:var(--green);text-transform:uppercase;font-size:.9em}.post h1.heading{margin-top:0}.post{--flow-space:var(--size-700);width:clamp(16rem,90vw,70rem);margin-left:auto;margin-right:auto;padding-right:1.5rem}.post time{--flow-space:var(--size-400);display:block}.post :is(h2,h3){--flow-space:var(--size-900)}.post :is(h2,h3)+*{--flow-space:var(--size-400)}.post code{background:var(--green);color:var(--white);border-radius:4px;padding:var(--space-s)}.post blockquote{font-style:italic;color:var(--blue);background:var(--grey);padding:var(--space-l);margin-left:var(--space-xl);font-size:1.1em;border-left:5px solid var(--green)}@media (max-width:700px){.post blockquote{margin-left:var(--space-m)}}.post-footer{border-top:2px solid var(--blue);margin:var(--space-xl) 0}</style><title>Why you should check-in your node dependencies - Jack Franklin</title><meta name=twitter:site content="Jack Franklin"><meta name=twitter:creator content=@jack_franklin><meta property=og:url content=www.https://jackfranklin.co.uk><style id=photoShowStyles_pointerNone>*:before,*:after{pointer-events:none!important}</style><meta name=twitter:card content=summary_large_image class=sf-hidden><meta name=twitter:title content="Why you should check-in your node dependencies" class=sf-hidden><meta name=twitter:image content=https://res.cloudinary.com/dtzvjz9gv/image/upload/w_1280,h_669,c_fill,q_auto,f_auto/w_760,c_fit,co_rgb:000000,g_south_west,x_480,y_254,l_text:Georgia_64:Why%20you%20should%20check-in%20your%20node%20dependencies/w_760,c_fit,co_rgb:000000,g_north_west,x_480,y_445,l_text:Georgia_48:jackfranklin.co.uk/blog-card-template class=sf-hidden><link rel=icon type=image/png sizes=32x32 href=data:image/png;base64,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><style>.sf-hidden{display:none!important}</style><link rel=canonical href=https://www.jackfranklin.co.uk/blog/check-in-your-node-dependencies/><meta http-equiv=content-security-policy content="default-src 'none'; font-src 'self' data:; img-src 'self' data:; style-src 'unsafe-inline'; media-src 'self' data:; script-src 'unsafe-inline' data:;"><body><header><h1><a href=https://www.jackfranklin.co.uk/ class=naked-link>Jack Franklin</a></h1><nav><ul><li><a href=https://www.jackfranklin.co.uk/blog class=nav-tab>Blog</a><li><a href=https://www.jackfranklin.co.uk/speaking class=nav-tab>Speaking</a><li><a href=https://www.twitter.com/Jack_Franklin class=nav-tab>Twitter</a><li><a href=https://www.jackfranklin.co.uk/feed.xml class=nav-tab>RSS</a></ul></nav></header><div class=content><section class="post flow"><time class=time value>December 6, 2021</time><h1 class=heading>Why you should check-in your node dependencies</h1><p>On every team at every company I've been at prior to my current role, the advice was simple: don't check your <code>node_modules</code> folder into your version control system (which I'll refer to as “Git” for the rest of this article…). This seemed like solid advice for multiple reasons:<ul><li>The code within <code>node_modules</code> isn't authored by the team directly.<li>The code within <code>node_modules</code> is often quite large and would cause a lot of noise in git diffs and pull requests.<li>The code within <code>node_modules</code> can easily be replicated with an <code>npm</code> install.</ul><p>I currently work at Google on the Chrome DevTools team and we check our <code>node_modules</code> folder into source control. At first this struck me as unusual, but I've come to believe that there are some major benefits to this approach that I think more people should consider.<h2>No need for npm installs</h2><p>Once you check your <code>node_modules</code> in, there's no need to run an install step before you can get up and running on the codebase. This isn't just useful for developers locally, but a big boost for any bots you might have running on a Continuous Integration platform (e.g. CircleCI, GitHub Actions, and so on). That's now a step that the bots can miss out entirely. I've seen projects easily need at least 1-2 minutes to run a complete <code>npm install</code> from scratch - and on bots that could be even longer. If you think that a bot runs on every pull request and deploy, you could easily have 50+ bots run each day. That's a lot of minutes (and bandwidth!) saved.<h2>Guaranteed replicated builds</h2><p>Having your <code>node_modules</code> checked in guarantees that two developers running the code are running the exact same code with the exact same set of dependencies. Yes, this can be managed by a package-lock.json file, or other tools, but I've seen all of them slip up rarely or allow a slight variation in a minor version number that causes issues. Once the dependencies are in git, you cannot possibly run with anything other than those and each developer will be running the exact codebase.<h2>Better awareness of the code you're shipping</h2><p>I've been surprised at how more aware I am of adding dependencies when the git diff shows me the entirety of the code that is being added to the project. This has lead us to make contributions to tools to help reduce their file size on disk and have a better awareness of the impact a dependency will have on our bundle size.<h2>More consideration to adding a dependency because it's not invisible</h2><p>I mentioned earlier that people see the noise in a git diff as a downside to adding dependencies to version control, and I do acknowledge that it can be a downside to this approach, but I've found that noise to often be a useful signal. Adding that one extra dependency because I don't want to write a few lines of code myself is something I used to do frequently - but now I'm much more considered because I can see the code that's being added and can reflect on if it's worth it.<p><em>Note: this doesn't mean that we don't have dependencies!</em> There are times where it is worth it to add a dependency - but seeing the code in version control has made me more considered about doing it - the cost is no longer invisible.<h2>You can manage the large diffs</h2><p>There is no shying away from the fact that if a developer works on a change that adds a new dependency, there could be a lot of noise in the diff. One of our dependencies that we check in is TypeScript, and every time we update that, the git diff is huge and frankly not worth looking at (beyond the CHANGELOG). We've come up with a rule that helps us here: a change that updates <code>node_modules</code> may not touch any other code in the codebase. So if I update <code>node_modules/typescript</code> with its latest version, I will be warned by our tooling if any other folder outside of <code>node_modules</code> is changed.<p>This rule serves us well the majority of the time, because any work that relies on a new or updated dependency can be split into two changes:<ol><li>Update the dependency<li>Use the dependency in the code</ol><p>There are times where this doesn't work; updating TypeScript may require us to update some code to fix errors that the new version of TypeScript is now detecting. In that case we have the ability to override the rule.<blockquote><p>As with anything in software engineering, most "rules" are guidelines, and we're able to side-step them when required.</p></blockquote><h2>Protection from another left pad</h2><p>The <a href=https://qz.com/646467/how-one-programmer-broke-the-internet-by-deleting-a-tiny-piece-of-code/>now infamous left_pad incident</a>, where a popular npm package was removed from the repository all of a sudden, causing builds everywhere to break, would not have impacted a team who checked all their dependencies into git. They would still have to deal with the long term impact of "what do we do with this now unsupported dependency", but in the short term their builds wouldn't break and they wouldn't be blocked on shipping new features.<h2>Conclusion</h2><p>If I was starting a new codebase this week, or joining a small start-up just getting their first version off the ground, I would advocate strongly for checking <code>node_modules</code> into version control. It absolutely takes some getting used to, but in my experience over the last two years of working this way the benefits I've listed above strongly outweigh the additional git noise and slight overhead.<div class=post-footer><p>If you enjoyed this post, be sure to <a href=https://www.twitter.com/jack_franklin>follow me on Twitter</a>.<p><a href=https://www.jackfranklin.co.uk/blog>All blog posts</a></p></div></section></div><tbdiv id=picinpicBtn class=sf-hidden></tbdiv><tbdiv id=playerControlBtn class=sf-hidden></tbdiv><tbdiv id=leftFullStackButton class=sf-hidden></tbdiv><tbdiv id=rightFullStackButton class=sf-hidden></tbdiv><div id=photoShowViewer class="sb_BingCA photoShow">
 <div class=photoshow-viewer-shadow></div>
 <div class="photoshow-img-wrapper sf-hidden">
 
 
 </div>
 <i class=photoshow-img-size></i>
 </div>